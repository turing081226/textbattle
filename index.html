<script>
  const $ = s=>document.querySelector(s);
  const adminBlock = $('#adminBlock');
  const meBlock = $('#meBlock');
  const meInfo = $('#meInfo');
  // ... (기존 코드 유지)

  async function refreshMe() {
    const { user, role } = await api('/api/auth/me');
    if (role === 'admin') {
      // Admin: 캐릭터 생성 가능, 내정보/전투 숨김
      adminBlock.style.display = '';
      meBlock.style.display = 'none';
      meInfo.textContent = '';
    } else if (role === 'character' && user) {
      // 캐릭터: 내정보/전투 표시, Admin 블록 숨김
      adminBlock.style.display = 'none';
      meBlock.style.display = '';
      meInfo.textContent = `#${user.id} ${user.name} — ELO ${user.elo}, ${user.wins}승 ${user.losses}패`;
    } else {
      // 비로그인
      adminBlock.style.display = 'none';
      meBlock.style.display = 'none';
      meInfo.textContent = '';
    }
  }

  // Admin 캐릭터 생성 요청은 password 포함해서 전송 (이미 반영되어 있으면 그대로)
  document.getElementById('createBtn').onclick = async ()=>{
    const name = document.getElementById('cName').value.trim();
    const description = document.getElementById('cDesc').value.trim();
    const password = document.getElementById('cPass').value;
    const msg = document.getElementById('createMsg');
    if (!name || !description || !password) { msg.textContent='이름/설정/비밀번호를 입력하세요.'; return; }
    if (password.length < 4) { msg.textContent='비밀번호는 4자 이상'; return; }
    try {
      const u = await api('/api/characters', { method:'POST', body:{ name, description, password } });
      msg.textContent = `생성 완료: #${u.id} ${u.name} (자동 로그인)`;
      await refreshMe(); await refreshLB();
      document.getElementById('cName').value='';
      document.getElementById('cDesc').value='';
      document.getElementById('cPass').value='';
    } catch(e) { msg.textContent = '생성 실패: ' + (e.error || 'unknown'); }
  };

  // 로그인 시: admin(아이디: admin / 비번: neuron)으로 로그인하면 생성 블록이 보임
  // ...(나머지 로그인/로그아웃/리더보드/전투 코드는 기존 그대로)...
</script>
